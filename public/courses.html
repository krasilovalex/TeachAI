<!DOCTYPE html>
<html lang="ru">
<head>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style id="theme-style"></style>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const tg = window.Telegram.WebApp;
      tg.ready(); // –≤–∞–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  
      const userId = tg.initDataUnsafe?.user?.id;
      if (userId) {
        document.body.dataset.userId = userId;
        console.log("userId:", userId);
      } else {
        console.warn("userId –Ω–µ –ø–æ–ª—É—á–µ–Ω –∏–∑ Telegram WebApp");
      }
    });
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–ö—É—Ä—Å: –í–≤–µ–¥–µ–Ω–∏–µ –≤ –ò–ò</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
    }
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Montserrat', sans-serif;
      background-color: #C8F7FF;
    }
    h1, h2, h3 {
      color: #222;
    }
    h1 {
      text-align: center;
      font-size: 20px;
      margin-bottom: 30px;
    }
    .module, .lesson, .block {
      background: #fff;
      border-radius: 25px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .lesson h3 {
      margin-top: 0;
      font-size: 16px;
      color: #333;
    }
    ul {
      padding-left: 20px;
      margin: 10px 0;
    }
    .block-title {
      font-weight: 700;
      color: #555;
      margin-top: 15px;
      margin-bottom: 5px;
    }
    .nav-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    .nav-buttons a {
      text-decoration: none;
      background-color: #C8F7FF;
      color: #020202;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .nav-buttons a:hover {
      background-color: #C8F7FF;
    }
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background-color: #fff;
      border-radius: 25px 25px 0 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .dom-btn {
      background: none;
      border: none;
      cursor: pointer;
    }

    .dom {
      height: 40px;
      width: auto;
    }
    .modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0, 0, 0, 0.3);
  padding: 60px 20px;
  overflow-y: auto;
}

.modal-content {
  background-color: #fff;
  margin: auto;
  padding: 20px;
  border-radius: 25px;
  width: 100%;
  max-width: 500px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  font-family: 'Montserrat', sans-serif;
  color: #222;
}

.close {
  color: #aaa;
  font-size: 24px;
  font-weight: bold;
  float: right;
  cursor: pointer;
  transition: color 0.2s;
  border: none;
  background: none;
}

.close:hover {
  color: #222;
}

.close:hover {
  color: black;
}

textarea {
  width: 100%;
  height: 100px;
  margin: 10px 0;
  resize: vertical;
}

.close {
  position: absolute;
  top: 10px; right: 15px;
  font-size: 24px;
  cursor: pointer;
}

  </style>
 <script>
  function isDark(hexColor) {
    const r = parseInt(hexColor.substr(1, 2), 16);
    const g = parseInt(hexColor.substr(3, 2), 16);
    const b = parseInt(hexColor.substr(5, 2), 16);
    const brightness = (r * 299 + g * 587 + b * 114) / 1000;
    return brightness < 128;
  }

  function applyTheme() {
    const tg = window.Telegram.WebApp;
    const theme = tg.themeParams || {};
    const isDarkMode = isDark(theme.secondary_bg_color || '#ffffff');

    if (!isDarkMode) return;

    const textColor = theme.text_color || '#ffffff';
    const hintColor = theme.hint_color || '#999999';
    const linkColor = theme.link_color || '#64b5f6';
    const buttonColor = theme.button_color || '#ffffff';
    const buttonTextColor = theme.button_text_color || '#000000';

    const style = `
      body, h1, h2, h3, p, ul, li, .nav-buttons a, .block-title {
        color: ${textColor} !important;
      }
      h4 {
      color:black;
      }
      .nav-buttons a {color:black !important;}

      .mod-con {
      color:white !important;
      background-color:#23282B !important;
      }

      .modal-content {
      color:white !important;
      background-color: #23282B !important;
    
      
      }

      .btn, button:not([style*="background:#C8F7FF"]) {
        background-color: ${buttonColor} !important;
        color: ${buttonTextColor} !important;
      }

      a {
        color: ${linkColor} !important;
      }

      .toast {
        background-color: ${hintColor} !important;
        color: ${textColor} !important;
      }
      .module, .lesson, .block {
       background-color: #23282B !important;
       box-shadow: 0 4px 12px rgb(255 255 255) !important;
      }
      .footer {background-color: #23282B !important;}
      button:not(.dom-btn):not(.nfi-help) {
      background-color: ${buttonColor} !important;
      color: ${buttonTextColor} !important;
      
}
      .kurs {color:black;}
    .footer .dom-btn,
    .footer .dom {
      background: none !important;
      filter: none !important;
    }      
    `;

    let styleTag = document.getElementById('theme-style');
    if (!styleTag) {
      styleTag = document.createElement('style');
      styleTag.id = 'theme-style';
      document.head.appendChild(styleTag);
    }
    styleTag.innerHTML = style;
  }

  window.addEventListener('DOMContentLoaded', applyTheme);
</script>


  
</head>
<body>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <h4>üß† –ö—É—Ä—Å: –í–≤–µ–¥–µ–Ω–∏–µ –≤ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –∏ –ò–ò</h4>

  <div class="module">
    <h2>–ú–æ–¥—É–ª—å 1: –í–≤–µ–¥–µ–Ω–∏–µ –≤ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ –∏ –ò–ò</h2>
    <p><strong>–¶–µ–ª—å:</strong> –ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å —Å –±–∞–∑–æ–≤—ã–º–∏ –ø–æ–Ω—è—Ç–∏—è–º–∏ –ò–ò, –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏ —Ä–∞–∑–≤–µ–Ω—á–∞—Ç—å –º–∏—Ñ—ã.</p>

    <div class="lesson">
      <h3>–£—Ä–æ–∫ 1.1 ‚Äî –ß—Ç–æ —Ç–∞–∫–æ–µ –ò–ò –∏ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏</h3>
      <div class="nav-buttons">
        <a href="#theory-1-1">üìò –¢–µ–æ—Ä–∏—è</a>
        <a href="#practice-1-1">üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞</a>
        <a href="#tasks-1-1">üìå –ó–∞–¥–∞–Ω–∏—è</a>
      </div>
      <div class="block" id="theory-1-1">
        <div class="block-title">üìò –¢–µ–æ—Ä–∏—è:</div>
        <ul>
          <li data-task-id="1-1">–ü–æ–Ω—è—Ç–∏–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ (–ò–ò)‚óÄÔ∏è</li>
          <li data-task-id="1-2">–†–∞–∑–ª–∏—á–∏–µ: –ò–ò vs –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ vs –ù–µ–π—Ä–æ—Å–µ—Ç—å‚óÄÔ∏è</li>
          <li data-task-id="1-3">–ö—Ä–∞—Ç–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è –ò–ò (–æ—Ç Turing Test –¥–æ GPT-4)‚óÄÔ∏è</li>
          <li data-task-id="1-4">–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –Ω–µ–π—Ä–æ—Å–µ—Ç–∏: –Ω–µ–π—Ä–æ–Ω—ã, —Å–ª–æ–∏, –≤–µ—Å–∞, –∞–∫—Ç–∏–≤–∞—Ü–∏—è‚óÄÔ∏è</li>
        </ul>
      </div>
      <div class="block" id="practice-1-1">
        <div class="block-title">üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞:</div>
        <ul>
          <li data-task-id="1-5">–°–ø—Ä–æ—Å–∏ —É –ò–ò‚óÄÔ∏è</li>
          <li data-task-id="1-6">–ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å —Å—Ö–µ–º—É: –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç—å‚óÄÔ∏è</li>
        </ul>
      </div>
      <div class="block" id="tasks-1-1">
        <div class="block-title">üìå –ó–∞–¥–∞–Ω–∏—è:</div>
        <ul>
          <li data-task-id="1-7" onclick="opensModal('modal-1')" style="cursor: pointer;">
            –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ò–ò –æ—Ç –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è?‚óÄÔ∏è
          </li>
              
              <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
              <div id="modal-1" class="modal">
                <div class="modal-content">
                  <span class="close" onclick="closesModal('modal-1')">&times;</span>
                  <h3>–ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –ò–ò –æ—Ç –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è?</h3>
                  <form onsubmit="checkAnswer(event, 'q1', 'b')">
                    <label><input style="margin-top:10px; background:#C8F7FF; color:rgb(0, 0, 0); padding:8px 16px; border:none; border-radius:10px;" type="radio" name="q1" value="a"> –≠—Ç–æ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ</label><br>
                    <label><input style="margin-top:10px; background:#C8F7FF; color:rgb(0, 0, 0); padding:8px 16px; border:none; border-radius:10px;"  type="radio" name="q1" value="b"> –ò–ò ‚Äî —ç—Ç–æ —à–∏—Ä–æ–∫–æ–µ –ø–æ–Ω—è—Ç–∏–µ, –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ ‚Äî –µ–≥–æ —á–∞—Å—Ç—å</label><br>
                    <label><input style="margin-top:10px; background:#C8F7FF; color:rgb(0, 0, 0); padding:8px 16px; border:none; border-radius:10px;" type="radio" name="q1" value="c"> –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ò–ò –Ω–∞–ø—Ä—è–º—É—é</label><br>
                    <button style="margin-top:10px; background:#C8F7FF; color:rgb(0, 0, 0); padding:8px 16px; border:none; border-radius:10px;" type="submit">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    <div id="result-q1" style="margin-top:5px;"></div>
                  </form>
                </div>
              </div>
          <li data-task-id = "1-15">–ü—Ä–∏–¥—É–º–∞—Ç—å –º–µ—Ç–∞—Ñ–æ—Ä—É, –æ–±—ä—è—Å–Ω—è—é—â—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å ‚óÄÔ∏è</li>
        </ul>
      </div>
    </div>

    <!-- –ü—Ä–∏–º–µ—Ä –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ -->
    <div class="lesson">
      <h3>–£—Ä–æ–∫ 1.2 ‚Äî –ì–¥–µ –º—ã —Å—Ç–∞–ª–∫–∏–≤–∞–µ–º—Å—è —Å –ò–ò</h3>
      <div class="nav-buttons">
        <a href="#theory-1-2">üìò –¢–µ–æ—Ä–∏—è</a>
        <a href="#practice-1-2">üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞</a>
        <a href="#tasks-1-2">üìå –ó–∞–¥–∞–Ω–∏—è</a>
      </div>
      <div class="block" id="theory-1-2">
        <div class="block-title">üìò –¢–µ–æ—Ä–∏—è:</div>
        <ul>
          <li data-task-id="1-8">–ü–æ–∏—Å–∫–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã‚óÄÔ∏è</li>
          <li data-task-id="1-9">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ YouTube/Spotify‚óÄÔ∏è</li>
          <li data-task-id="1-10">–ù–∞–≤–∏–≥–∞—Ç–æ—Ä—ã‚óÄÔ∏è</li>
          <li data-task-id="1-11">–ö–∞–º–µ—Ä—ã —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤‚óÄÔ∏è</li>
          <li data-task-id="1-12">–ë–æ—Ç—ã: ChatGPT, –ê–ª–∏—Å–∞, Siri‚óÄÔ∏è</li>
        </ul>
      </div>
      <div class="block" id="practice-1-2">
        <div class="block-title">üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞:</div>
        <ul>
          <li data-task-id="1-13">–ù–∞–π—Ç–∏ 5 —Å–µ—Ä–≤–∏—Å–æ–≤, –≥–¥–µ —Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ò–ò –∑–∞ 24 —á–∞—Å–∞‚óÄÔ∏è</li>
        </ul>
      </div>
      <div class="block" id="tasks-1-2">
        <div class="block-title">üìå –ó–∞–¥–∞–Ω–∏—è:</div>
        <ul>
          <li data-task-id="1-14">–°–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É: –°–µ—Ä–≤–∏—Å ‚Üí –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ò–ò? ‚Üí –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —á–µ–ª–æ–≤–µ–∫?‚óÄÔ∏è</li>
        </ul>
      </div>
    </div>

    <div class="lesson">
      <h3>–£—Ä–æ–∫ 1.3 ‚Äî –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ò–ò</h3>
      <div class="nav-buttons">
        <a href="#theory-1-3">üìò –¢–µ–æ—Ä–∏—è</a>
        <a href="#practice-1-3">üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞</a>
        <a href="#tasks-1-3">üìå –ó–∞–¥–∞–Ω–∏—è</a>
      </div>
      <div class="block" id="theory-1-3">
        <div class="block-title">üìò –¢–µ–æ—Ä–∏—è:</div>
        <ul>
          <li data-task-id="1-16">–ß—Ç–æ —É–º–µ—é—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ò–ò (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏, –ø–µ—Ä–µ–≤–æ–¥, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)‚óÄÔ∏è</li>
          <li data-task-id="1-17">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: —Ñ–∞–Ω—Ç–∞–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–µ—Ç –æ–±—â–µ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –¥–∞–Ω–Ω—ã—Ö‚óÄÔ∏è</li>
          <li data-task-id="1-18">–ü–æ–Ω—è—Ç–∏–µ '–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏' –≤ —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª—è—Ö‚óÄÔ∏è</li>
        </ul>
      </div>
      <div class="block" id="practice-1-3">
        <div class="block-title">üß™ –ü—Ä–∞–∫—Ç–∏–∫–∞:</div>
        <ul>
          <li data-task-id="1-19">–ü—Ä–æ–≤–µ—Å—Ç–∏ –º–∏–Ω–∏-—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç: –∑–∞–¥–∞—Ç—å YandexGPT(–∏–∫–æ–Ω–∫–∞ –≤ –≤–∏–¥–µ –Ω–µ–π—Ä–æ–Ω–æ–≥–æ –º–æ–∑–≥–∞) –∑–∞–≤–µ–¥–æ–º–æ –ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç‚óÄÔ∏è</li>
          <li data-task-id="1-20">–°—Ä–∞–≤–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã ChatGPT –∏ Google –Ω–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –≤–æ–ø—Ä–æ—Å‚óÄÔ∏è</li>
          
        </ul>
       
    </div>
      </div>
      <div class="block-title">–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫—É:</div>
    <div style="display: flex; flex-direction: column; gap: 10px;">
      <textarea id="mentor-input" placeholder="–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å..." style="height: 80px; border-radius: 15px; padding: 10px;"></textarea>
      <button onclick="sendToMentor()" style="background: #C8F7FF; color: black; border: none; padding: 10px; border-radius: 15px; font-weight: bold; cursor: pointer;">–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å</button>
    </div>
    <div id="mentor-chat" style="margin-top: 20px; max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;"></div>
    
      
      
      <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
      <div id="answerModal" class="modal" style="display:none;">
        <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <h3>–û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ</h3>
          <textarea id="userAnswer" placeholder="–ù–∞–ø–∏—à–∏ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –∑–¥–µ—Å—å..."></textarea>
          <button onclick="submitAnswer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  </div>

  


  <div class="footer">
    <button class="dom-btn" onclick="window.location.href='learn.html'" title="–ù–∞–∑–∞–¥">
      <img src="domik.png" alt="–î–æ–º–æ–π" class="dom">
    </button>
    <button class="dom-btn" onclick="window.location.href='test_prompt.html'" title="–ü—Ä–æ–º–ø—Ç" style="margin-left: 20px;">
      <img src="ai.png" alt="–ü—Ä–æ–º–ø—Ç" class="dom">
    </button>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∏ marked.js -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
  async function sendToMentor() {
    const input = document.getElementById('mentor-input');
    const chat = document.getElementById('mentor-chat');
    const message = input.value.trim();
    const userId = document.body.dataset.userId;
    if (!message || !userId) return;

    // ‚úâÔ∏è –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const userMsg = document.createElement('div');
    userMsg.innerText = message;
    userMsg.style.alignSelf = 'flex-end';
    userMsg.style.background = '#DCF8C6';
    userMsg.style.padding = '10px';
    userMsg.style.borderRadius = '15px';
    userMsg.style.maxWidth = '80%';
    userMsg.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
    userMsg.style.color = 'grey';
    userMsg.style.whiteSpace = 'pre-wrap';
    chat.appendChild(userMsg);
    chat.scrollTop = chat.scrollHeight;

    input.value = '';

    // ‚è≥ –ó–∞–≥–ª—É—à–∫–∞
    const responseMsg = document.createElement('div');
    responseMsg.innerText = '–ù–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥—É–º–∞–µ—Ç...';
    responseMsg.style.alignSelf = 'flex-start';
    responseMsg.style.background = '#fff';
    responseMsg.style.padding = '10px';
    responseMsg.style.borderRadius = '15px';
    responseMsg.style.maxWidth = '80%';
    responseMsg.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
    responseMsg.style.color = 'grey';
    responseMsg.style.whiteSpace = 'pre-wrap';
    chat.appendChild(responseMsg);
    chat.scrollTop = chat.scrollHeight;

    try {
      const res = await fetch('/mentor', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: userId, message })
      });
      const data = await res.json();

      // ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ Markdown –∏ –∑–∞–º–µ–Ω–∞ –Ω–∞ HTML
      const rawMarkdown = data.reply || '–û—Ç–≤–µ—Ç –Ω–µ –ø–æ–ª—É—á–µ–Ω.';
      const html = marked.parse(rawMarkdown);

      responseMsg.innerHTML = html;
      responseMsg.style.whiteSpace = 'normal'; // –í–∞–∂–Ω–æ: –æ—Ç–∫–ª—é—á–∏—Ç—å pre-wrap –¥–ª—è HTML

      chat.scrollTop = chat.scrollHeight;
    } catch (err) {
      responseMsg.innerText = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.';
      chat.scrollTop = chat.scrollHeight;
    }
  }
</script>



  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
  <div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; animation: fadeIn 0.3s ease;">
      <div id="modal-content" class="mod-con" style="background:#fff; padding:20px; border-radius:15px; max-width:90%; max-height:80%; overflow:auto; box-shadow:0 4px 12px rgba(0,0,0,0.2);">
        <h2 id="modal-title"></h2>
        <div id="modal-text" style="white-space: pre-wrap;"></div>
        <button onclick="closeModal()" style="margin-top:10px; background:#C8F7FF; color:rgb(0, 0, 0); padding:8px 16px; border:none; border-radius:10px;">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
 
  <div id="notification" style="
  position: fixed;
  top: 20px;
  right: 20px;
  background: #4ecdc4;
  color: white;
  padding: 12px 18px;
  border-radius: 8px;
  font-weight: bold;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  display: none;
  z-index: 1000;">
  +50 –æ–ø—ã—Ç–∞!
</div>
  
  <!-- –ê–Ω–∏–º–∞—Ü–∏—è -->
  <style>
  @keyframes fadeIn {
    from {opacity: 0;}
    to {opacity: 1;}
  }
  </style>
  
  <!-- JavaScript -->
  <script>
let currentTaskId = null;

document.querySelectorAll(".open-answer-btn").forEach(button => {
  button.addEventListener("click", function () {
    const taskEl = this.closest(".task");
    const taskId = taskEl.getAttribute("data-task-id");
    currentTaskId = taskId;
    console.log("–í—ã–±—Ä–∞–Ω taskId:", currentTaskId); // –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    openedsModal(taskId); // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å taskId!
  });
});

function openedsModal(taskId) {
  const modal = document.getElementById("answerModal");
  modal.style.display = "flex";
  document.getElementById("modalTitle").innerText = `–û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ ${taskId}`;
  document.getElementById("userAnswer").value = "";
  modal.setAttribute("data-task-id", taskId);
}


function closeModal() {
  document.getElementById("answerModal").style.display = "none";
}

function submitAnswer() {
  console.log("submitAnswer –∑–∞–ø—É—â–µ–Ω. currentTaskId:", currentTaskId);
  const answer = document.getElementById("userAnswer").value.trim();
  const userId = window.currentUserId || "123";

  if (!currentTaskId) {
    alert("–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω taskId.");
    return;
  }

  if (!answer) {
    alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π.");
    return;
  }

  fetch("/mark_task_complete", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      task_id: currentTaskId,
      user_id: userId,
      answer: answer
    })
  })
    .then(res => {
      if (!res.ok) throw new Error("HTTP —Å—Ç–∞—Ç—É—Å: " + res.status);
      return res.json();
    })
    .then(data => {
      console.log("–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);
      if (data.success) {
        if (data.was_already_completed) {
          alert("‚è≥ –ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å, –æ–ø—ã—Ç –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω");
        } else {
          alert(`üî• +50 –æ–ø—ã—Ç–∞! –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ${data.current_level}`);
        }
        closeModal();
      }
    })
    .catch(err => {
      console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", err);
      alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü—Ä–æ–≤–µ—Ä—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ –ª–æ–≥.");
    });
}
function toggleTest(id) {
  const el = document.getElementById(id);
  el.style.display = (el.style.display === 'none') ? 'block' : 'none';
}
function opensModal(id) {
  document.getElementById(id).style.display = 'block';
}

function closesModal(id) {
  document.getElementById(id).style.display = 'none';
}

function checkAnswer(event, questionId, correctAnswer) {
  event.preventDefault();
  const form = event.target;
  const selected = form.querySelector(`input[name="${questionId}"]:checked`);
  const resultDiv = document.getElementById(`result-${questionId}`);

  if (!selected) {
    resultDiv.innerText = "–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞.";
    resultDiv.style.color = "orange";
    return;
  }

  if (selected.value === correctAnswer) {
    resultDiv.innerText = "–í–µ—Ä–Ω–æ!";
    resultDiv.style.color = "green";

    // –ü–æ–ª—É—á–∞–µ–º id –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const modal = form.closest('.modal');
    if (modal) {
      // –ù–∞—Ö–æ–¥–∏–º <li> –ø–æ –∞—Ç—Ä–∏–±—É—Ç—É onclick, —Å–æ–¥–µ—Ä–∂–∞—â–µ–º—É id —ç—Ç–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      const taskTrigger = document.querySelector(`li[onclick*="${modal.id}"][data-task-id]`);
      const taskId = taskTrigger?.dataset.taskId;

      if (taskId && typeof userId !== "undefined") {
  markTaskComplete(taskId, userId);
} else {
  console.warn("–ù–µ –Ω–∞–π–¥–µ–Ω taskId –∏–ª–∏ userId");
}
    }
  } else {
    resultDiv.innerText = "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
    resultDiv.style.color = "red";
  }
}

let theoryData = {};

fetch("theoryData.json")
  .then((res) => res.json())
  .then((data) => {
    theoryData = data;
    console.log("–¢–µ–æ—Ä–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞:", theoryData);
  })
  .catch((err) => console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ theoryData:", err));




  
const userId = window.Telegram.WebApp.initDataUnsafe?.user?.id;

function openModal(li) {
  const title = li.textContent.trim();
  const taskId = li.dataset.taskId;

  document.getElementById("modal-title").textContent = title;
  document.getElementById("modal-text").innerHTML =
    (theoryData[title] || "–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ.").replace(/\n/g, '<br>');

  const modal = document.getElementById("modal");
  modal.style.display = "flex";
  modal.dataset.taskId = taskId;

  console.log("–ú–æ–¥–∞–ª –æ—Ç–∫—Ä—ã—Ç, taskId —Å–æ—Ö—Ä–∞–Ω–µ–Ω:", taskId);
}

function openedModal(li) {
  const title = li.textContent.trim();
  const taskId = li.dataset.taskId;

  document.getElementById("modal-title").textContent = title;
  document.getElementById("modal-text").innerHTML =
    (theorysData[title] || "–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ.").replace(/\n/g, '<br>');

  const modal = document.getElementById("modal");
  modal.style.display = "flex";
  modal.dataset.taskId = taskId;

  console.log("–ú–æ–¥–∞–ª –æ—Ç–∫—Ä—ã—Ç, taskId —Å–æ—Ö—Ä–∞–Ω–µ–Ω:", taskId);
}

function closeModal() {
  const modal = document.getElementById("modal");
  modal.style.display = "none";

  const taskId = modal.dataset.taskId;
  if (taskId && userId) {
    console.log("–ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏, –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:", taskId, userId);
    markTaskComplete(taskId, userId);
  } else {
    console.warn("taskId –∏–ª–∏ userId –Ω–µ –Ω–∞–π–¥–µ–Ω –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª–∫–∏");
  }
}

function markTaskComplete(taskId, userId, answerText) {
  return fetch("/mark_task_complete", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      task_id: taskId,
      user_id: userId,
      answer: answerText
    })
  })
  .then(res => {
    if (!res.ok) throw new Error(`–û—à–∏–±–∫–∞ ${res.status}`);
    return res.json();
  })
  .then(data => {
    console.log("–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);
    if (data.success) {
      if (data.was_already_completed) {
        showNotification("‚è≥ –ó–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å, –æ–ø—ã—Ç –Ω–µ –Ω–∞—á–∏—Å–ª–µ–Ω");
      } else {
        showNotification(`üî• +50 –æ–ø—ã—Ç–∞! –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: ${data.current_level}`);
      }
    } else {
      alert("–û—à–∏–±–∫–∞: " + data.message);
    }
  });
}


function showNotification(message) {
  const notification = document.getElementById("notification");
  notification.textContent = message;
  notification.style.display = "block";
  
  setTimeout(() => {
    notification.style.display = "none";
  }, 3000);
}

document.querySelectorAll(
  "#theory-1-1 li, #practice-1-1 li, #theory-1-2 li, #practice-1-2 li, #tasks-1-2 li, #tasks-1-1 li, #theory-1-3 li, #practice-1-3 li, #tasks-1-3 li"
).forEach((li) => {
  const taskId = li.getAttribute("data-task-id");
  // –∏—Å–∫–ª—é—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å onclick –≤—Ä—É—á–Ω—É—é ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, task 1-7
  if (taskId === "1-7") return;
  li.style.cursor = "pointer";
  li.addEventListener("click", () => openModal(li));
});



document.getElementById("modal-close").addEventListener("click", closeModal);
  </script>
</body>
</html>
